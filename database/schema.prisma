datasource db {
  provider = "postgresql"
}

generator kysely {
  provider        = "prisma-kysely"
  output          = "generated"
  fileName        = "tables.ts"
  enumFileName    = "enums.ts"
  importExtension = ".ts"
  camelCase       = true
}

model page {
  url String

  language_code LanguageCode
  type          LinkType
  title         String
  description   String
  summary       String
  content       String
  reading_time  Int
  /// @kyselyType({ keyword: string, emoji: string }[])
  tags          Json

  embedding Unsupported("vector(1536)")

  created_at DateTime  @default(now()) @db.Timestamptz(3)
  updated_at DateTime? @db.Timestamptz(3)

  @@id([url])
}

model link {
  user_id String

  url  String
  slug String

  language_code LanguageCode
  type          LinkType
  title         String
  description   String
  summary       String
  content       String
  reading_time  Int

  /// @kyselyType(number[])
  embedding Unsupported("vector(1536)")

  created_at DateTime  @default(now()) @db.Timestamptz(3)
  updated_at DateTime? @db.Timestamptz(3)

  is_favorite Boolean?
  link_tags   link_tag[]

  @@id([user_id, url])
  @@unique([user_id, slug])
  @@index([user_id])
}

model tag {
  slug String

  language_code LanguageCode
  keyword       String

  emoji String

  created_at DateTime  @default(now()) @db.Timestamptz(3)
  updated_at DateTime? @db.Timestamptz(3)

  link_tags link_tag[]

  @@id([slug])
  @@unique([language_code, keyword])
}

model link_tag {
  user_id  String
  url      String
  tag_slug String

  link link @relation(fields: [user_id, url], references: [user_id, url], onDelete: Cascade)
  tag  tag  @relation(fields: [tag_slug], references: [slug], onDelete: Cascade)

  @@id([user_id, url, tag_slug])
}

model feed {
  user_id String

  source String
  slug   String

  type FeedType

  created_at DateTime  @default(now()) @db.Timestamptz(3)
  updated_at DateTime? @db.Timestamptz(3)

  @@id([user_id, source])
  @@unique([user_id, slug])
}

model channel {
  id String @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  user_id String
  slug    String

  title String

  query String?

  type             LinkType?
  tag_ids          String[]  @default([])
  min_reading_time Int?
  max_reading_time Int?

  inbox_count    Int
  snoozed_count  Int
  archived_count Int

  created_at DateTime  @default(now()) @db.Timestamptz(3)
  updated_at DateTime? @db.Timestamptz(3)

  @@id([id])
  @@unique([user_id, slug])
}

enum LinkType {
  article
  video
}

enum FeedType {
  rss
}

enum LanguageCode {
  aa // Afar
  ab // Abkhazian
  ae // Avestan
  af // Afrikaans
  ak // Akan
  am // Amharic
  an // Aragonese
  ar // Arabic
  as // Assamese
  av // Avaric
  ay // Aymara
  az // Azerbaijani
  ba // Bashkir
  be // Belarusian
  bg // Bulgarian
  bh // Bihari languages
  bi // Bislama
  bm // Bambara
  bn // Bengali
  bo // Tibetan
  br // Breton
  bs // Bosnian
  ca // Catalan
  ce // Chechen
  ch // Chamorro
  co // Corsican
  cr // Cree
  cs // Czech
  cu // Church Slavic
  cv // Chuvash
  cy // Welsh
  da // Danish
  de // German
  dv // Divehi
  dz // Dzongkha
  ee // Ewe
  el // Greek
  en // English
  eo // Esperanto
  es // Spanish
  et // Estonian
  eu // Basque
  fa // Persian
  ff // Fulah
  fi // Finnish
  fj // Fijian
  fo // Faroese
  fr // French
  fy // Western Frisian
  ga // Irish
  gd // Gaelic
  gl // Galician
  gn // Guarani
  gu // Gujarati
  gv // Manx
  ha // Hausa
  he // Hebrew
  hi // Hindi
  ho // Hiri Motu
  hr // Croatian
  ht // Haitian
  hu // Hungarian
  hy // Armenian
  hz // Herero
  ia // Interlingua
  id // Indonesian
  ie // Interlingue
  ig // Igbo
  ii // Sichuan Yi
  ik // Inupiaq
  io // Ido
  is // Icelandic
  it // Italian
  iu // Inuktitut
  ja // Japanese
  jv // Javanese
  ka // Georgian
  kg // Kongo
  ki // Kikuyu
  kj // Kuanyama
  kk // Kazakh
  kl // Kalaallisut
  km // Central Khmer
  kn // Kannada
  ko // Korean
  kr // Kanuri
  ks // Kashmiri
  ku // Kurdish
  kv // Komi
  kw // Cornish
  ky // Kirghiz
  la // Latin
  lb // Luxembourgish
  lg // Ganda
  li // Limburgan
  ln // Lingala
  lo // Lao
  lt // Lithuanian
  lu // Luba-Katanga
  lv // Latvian
  mg // Malagasy
  mh // Marshallese
  mi // Maori
  mk // Macedonian
  ml // Malayalam
  mn // Mongolian
  mr // Marathi
  ms // Malay
  mt // Maltese
  my // Burmese
  na // Nauru
  nb // Norwegian Bokmål
  nd // North Ndebele
  ne // Nepali
  ng // Ndonga
  nl // Dutch
  nn // Norwegian Nynorsk
  no // Norwegian
  nr // South Ndebele
  nv // Navajo
  ny // Chichewa
  oc // Occitan
  oj // Ojibwa
  om // Oromo
  or // Oriya
  os // Ossetian
  pa // Panjabi
  pi // Pali
  pl // Polish
  ps // Pushto
  pt // Portuguese
  qu // Quechua
  rm // Romansh
  rn // Rundi
  ro // Romanian
  ru // Russian
  rw // Kinyarwanda
  sa // Sanskrit
  sc // Sardinian
  sd // Sindhi
  se // Northern Sami
  sg // Sango
  si // Sinhala
  sk // Slovak
  sl // Slovenian
  sm // Samoan
  sn // Shona
  so // Somali
  sq // Albanian
  sr // Serbian
  ss // Swati
  st // Southern Sotho
  su // Sundanese
  sv // Swedish
  sw // Swahili
  ta // Tamil
  te // Telugu
  tg // Tajik
  th // Thai
  ti // Tigrinya
  tk // Turkmen
  tl // Tagalog
  tn // Tswana
  to // Tonga
  tr // Turkish
  ts // Tsonga
  tt // Tatar
  tw // Twi
  ty // Tahitian
  ug // Uighur
  uk // Ukrainian
  ur // Urdu
  uz // Uzbek
  ve // Venda
  vi // Vietnamese
  vo // Volapük
  wa // Walloon
  wo // Wolof
  xh // Xhosa
  yi // Yiddish
  yo // Yoruba
  za // Zhuang
  zh // Chinese
  zu // Zulu
}
